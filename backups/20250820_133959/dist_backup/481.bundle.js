(self.webpackChunkautocomplaint_extension=self.webpackChunkautocomplaint_extension||[]).push([[481],{481:e=>{class t{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{if(console.log("üîÑ Loading DistilBERT model..."),void 0===window.pipeline)throw new Error("Pipeline function not available. Make sure @xenova/transformers is loaded.");return this.classifier=await window.pipeline("sentiment-analysis",this.modelName),this.isLoaded=!0,console.log("‚úÖ DistilBERT model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const i=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],s=e.toLowerCase(),o=i.filter(e=>s.includes(e)).length,n=await this.classifier(e),a=Math.min(o/5,1),r=.7*a+.3*n[0].score,c=o>=2&&r>.6,l={isOrder:c,confidence:r,method:"distilbert-sentiment-adapted",topLabel:c?"order page":"non-order page",allPredictions:[{label:"order page",score:r},{label:"non-order page",score:1-r}],details:{model:this.modelName,keywordMatches:o,keywordConfidence:a,sentimentResult:n,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:l,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:c,confidence:r.toFixed(3),keywordMatches:o,sentiment:n[0].label}),l}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){try{const e=this.extractPageContent();if(!e||e.trim().length<50)throw new Error("Insufficient page content for DistilBERT classification");const t=await this.classify(e);return t.pageInfo={contentLength:e.length,url:window.location.href,title:document.title,timestamp:(new Date).toISOString(),modelUsed:"DistilBERT MNLI"},t}catch(e){throw console.error("‚ùå DistilBERT page classification error:",e),e}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const i=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let s,o;return t.isOrder?(s=i.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||i[0],o=t.confidence):(s=i.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||i[i.length-1],o=1-t.confidence),{isOrder:t.isOrder,confidence:o,method:"distilbert-sentiment-custom",topLabel:s,allPredictions:i.map(e=>{const s=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:s===t.isOrder?o:(1-o)/(i.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){const e=["main",'[role="main"]',".order",".invoice",".receipt",".confirmation",".order-details",".order-summary","h1, h2, h3",".title",".heading",".product-title",".checkout",".cart"];let t="";for(const i of e){const e=document.querySelectorAll(i);for(const i of e)i.textContent&&(t+=i.textContent+" ")}return t.trim().length<100&&(t=document.body.textContent||""),t.substring(0,2e3)}getCacheKey(e){let t=0;for(let i=0;i<Math.min(e.length,100);i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT Order Classifier",model:this.modelName,type:"sentiment-analysis-adapted",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=t),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=t)}}]);