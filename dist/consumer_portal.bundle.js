!function(){console.log("ðŸš€ Enhanced Consumer Portal Auto-Fill v3.0 loaded - Grievance Form Optimized");const e=async(e,t)=>{if("SELECT"===e.tagName)for(let o of e.options)if(o.text.toLowerCase().includes(t.toLowerCase()))return o.selected=!0,e.dispatchEvent(new Event("change",{bubbles:!0})),!0;await(async(e,t)=>{const o=e=>new Promise(t=>setTimeout(t,e));e.value="",e.dispatchEvent(new Event("focus"));for(let a of t)e.value+=a,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keydown",{key:a})),await o(50+50*Math.random());e.dispatchEvent(new Event("change",{bubbles:!0})),await o(300)})(e,t);const o=[...document.querySelectorAll('.dropdown-list, .select-options, .suggestions, [class*="dropdown"], [class*="autocomplete"]'),...document.querySelectorAll('ul[style*="display: block"], div[style*="display: block"] > ul')];for(const e of o){const o=e.querySelectorAll('li, .option, [role="option"]');for(const e of o)if(e.textContent.toLowerCase().includes(t.toLowerCase()))return e.click(),!0}return!1},t={grievanceType:['select[name*="grievance"][name*="type"]','select[name*="complaint"][name*="type"]',"#grievanceType",".grievance-type-dropdown"],grievanceClassification:['select[name*="grievance"][name*="classification"]','select[name*="complaint"][name*="classification"]',"#grievanceClassification",".grievance-classification-dropdown"],state:['select[name*="state"]',"#state",".state-dropdown",'select[aria-label*="State"]'],purchaseCity:['select[name*="city"]','select[name*="purchase"][name*="city"]',"#city",".city-dropdown",'select[aria-label*="City"]'],sectorIndustry:['select[name*="sector"]','select[name*="industry"]',"#sector","#industry",".sector-dropdown",".industry-dropdown",'select[aria-label*="Sector"]','select[aria-label*="Industry"]'],category:['select[name*="category"]','select[name*="product"][name*="category"]',"#category",".category-dropdown",'select[aria-label*="Category"]'],company:['select[name*="company"]','select[name*="seller"]','select[name*="brand"]',"#company",".company-dropdown",'select[aria-label*="Company"]'],natureOfGrievance:['select[name*="nature"]','select[name*="grievance"][name*="nature"]',"#natureOfGrievance",".nature-dropdown",'select[aria-label*="Nature of Grievance"]'],productValue:['select[name*="product"][name*="value"]','select[name*="price"]','select[name*="amount"]',"#productValue",".product-value-dropdown",'select[aria-label*="Product Value"]'],dealerInfo:['textarea[name*="dealer"]','textarea[name*="seller"][name*="info"]','textarea[name*="contact"]',"#dealerInfo",".dealer-info-field",'textarea[aria-label*="Dealer"]','textarea[placeholder*="dealer"]']};function o(e,t,o){const a=document.querySelector(e);return a&&t?(console.log(`ðŸ“ Setting text field ${o}:`,t),a.value=t,a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})),a.dispatchEvent(new Event("blur",{bubbles:!0})),{success:!0,value:t}):{success:!1,reason:"No element or value"}}async function a(a){console.log("ðŸŽ¯ Starting enhanced grievance form filling with data:",a);const n={},r=["company","productValue","purchaseCity","category","sectorIndustry","dealerInfo","customerName","email","phone","orderId","productName"];for(const s of r){const r=a[s];if(!r){n[s]={success:!1,reason:"No data available"};continue}const l=t[s]||[];let c=!1;for(const t of l)try{const a=document.querySelector(t);if(!a||null===a.offsetParent)continue;let l;if("SELECT"===a.tagName||a.classList.contains("dropdown")||"combobox"===a.getAttribute("role")?l=e(a,r):"INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName||(l=o(t,r,s)),l&&l.success){n[s]={...l,selector:t,fieldType:s},c=!0;break}}catch(e){console.warn(`Error filling ${s} with selector ${t}:`,e)}c||(n[s]={success:!1,reason:"No suitable field found",searchedSelectors:l,value:r})}const s=Object.values(n).filter(e=>e.success).length,l=r.length,c={total:l,successful:s,failed:l-s,successRate:`${Math.round(s/l*100)}%`,timestamp:(new Date).toISOString()};return console.log("âœ… Enhanced form filling completed:",{summary:c,results:n}),{summary:c,results:n}}async function n(){console.log("ðŸš€ Enhanced autofill triggered on grievance portal");try{const e=document.createElement("div");e.style.cssText="\n        position: fixed; top: 20px; right: 20px; z-index: 10000;\n        background: #4CAF50; color: white; padding: 12px 20px;\n        border-radius: 6px; font-family: Arial, sans-serif;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        transition: opacity 0.3s ease;\n      ",e.textContent="Filling form with enhanced order details...",document.body.appendChild(e),setTimeout(()=>{e.parentNode&&(e.style.opacity="0",setTimeout(()=>e.remove(),300))},4e3)}catch(e){console.warn("Toast notification failed:",e)}return new Promise((e,t)=>{chrome.storage.local.get(["autoComplaintOrderUniversal","autoComplaintOrderOCR","autoComplaintOrderNER","autoComplaintOrderCompromise","autoComplaintOrder"],async o=>{try{if(chrome.runtime.lastError)throw new Error(`Storage error: ${chrome.runtime.lastError.message}`);let t=o.autoComplaintOrderUniversal||o.autoComplaintOrderOCR||o.autoComplaintOrderNER||o.autoComplaintOrderCompromise||o.autoComplaintOrder;if(!t)throw new Error("No order data found in storage");console.log("ðŸŽ¯ Retrieved enhanced order data:",t);const n=await a(t),r=document.querySelector('[style*="background: #4CAF50"]');n.summary.successful>0?(console.log(`âœ… Successfully filled ${n.summary.successful}/${n.summary.total} fields`),r&&(r.style.background="#4CAF50",r.textContent=`âœ… Filled ${n.summary.successful}/${n.summary.total} fields successfully!`),e(n)):(console.warn("âš ï¸ No fields could be auto-filled"),r&&(r.style.background="#FF9800",r.textContent="âš ï¸ Could not auto-fill any fields - manual entry required"),e(n))}catch(e){console.error("âŒ Enhanced autofill failed:",e);const o=document.querySelector('[style*="background: #4CAF50"]');o&&(o.style.background="#f44336",o.textContent="âŒ Auto-fill failed - "+e.message),t(e)}})})}"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.onMessage.addListener((e,t,o)=>{if("fillForm"===e.action)console.log("ðŸ“¨ Received enhanced fillForm message"),n().then(e=>{console.log("âœ… Enhanced autofill completed successfully"),o({success:!0,message:`Filled ${e.summary.successful}/${e.summary.total} fields`,result:e})}).catch(e=>{console.error("âŒ Enhanced autofill failed:",e);let t="Failed to fill form";e.message.includes("No order data")?t="No order data found. Please save order details from an e-commerce site first.":e.message.includes("Storage error")&&(t="Storage access failed. Please check extension permissions."),o({success:!1,message:t,error:e.message})});else if("fillGrievanceForm"===e.action)return a(e.data).then(()=>o({success:!0})).catch(e=>{console.error("Error filling form:",e),o({success:!1,error:e.message})}),!0;return!0}),window.fillGrievanceForm=a,window.autofillGrievancePortal=n,console.log("ðŸŽ¯ Enhanced Consumer Portal Auto-Fill ready - grievance form optimized")}();