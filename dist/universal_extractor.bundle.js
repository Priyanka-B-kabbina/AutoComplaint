(()=>{"use strict";var e={481:(e,o,t)=>{t.d(o,{A:()=>r}),e=t.hmd(e);class n{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{return console.log("üîÑ Loading DistilBERT model..."),this.classifier=await this.createSentimentClassifier(),this.isLoaded=!0,console.log("‚úÖ DistilBERT-inspired model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async createSentimentClassifier(){return e=>{const o=e.toLowerCase(),t=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity","price","confirmation","thank you","estimated delivery"].filter(e=>o.includes(e)).length,n=[/order\s*#?\s*[a-z0-9\-]+/i,/\$[\d,]+\.?\d*/,/total:?\s*\$?[\d,]+\.?\d*/i,/delivered?\s+on/i,/shipped?\s+on/i,/tracking\s+(number|#)/i].filter(o=>o.test(e)).length,r=["confirmed","success","complete","delivered","shipped","thank","congratulations","approved","processed"].filter(e=>o.includes(e)).length,s=.5*Math.min(t/8,1)+.3*Math.min(n/3,1)+.2*Math.min(r/4,1),i=s>.4;return[{label:i?"POSITIVE":"NEGATIVE",score:i?.6+.4*s:.4-.4*s}]}}async classify(e){var o;if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e||0===e.trim().length)return console.warn("‚ö†Ô∏è CLASSIFICATION WARNING - Invalid or empty text input:",{text:e,type:typeof e,length:(null===(o=e)||void 0===o?void 0:o.length)||0}),{isOrder:!1,confidence:0,method:"distilbert-sentiment-adapted",topLabel:"non-order page",allPredictions:[{label:"non-order page",score:1},{label:"order page",score:0}],details:{model:this.modelName,keywordMatches:0,keywordConfidence:0,sentimentResult:[{label:"NEGATIVE",score:1}],timestamp:(new Date).toISOString(),error:"Invalid or empty text input"}};(e=e.trim()).length<10&&console.warn("‚ö†Ô∏è CLASSIFICATION WARNING - Text too short for reliable classification:",e.length),console.log("üîç CLASSIFICATION DEBUG - Input text length:",e.length),console.log("üîç CLASSIFICATION DEBUG - First 200 chars:",e.slice(0,200));const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const o=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],n=e.toLowerCase(),r=o.filter(e=>n.includes(e)),s=r.length;console.log("üîç CLASSIFICATION DEBUG - Found keywords:",r),console.log("üîç CLASSIFICATION DEBUG - Keyword matches:",s);const i=await this.classifier(e);console.log("üîç CLASSIFICATION DEBUG - Sentiment result:",i);const l=Math.min(s/5,1),a=i[0].score;console.log("üîç CLASSIFICATION DEBUG - Keyword confidence:",l.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Sentiment confidence:",a.toFixed(3));const c=.7*l+.3*a,d=s>=2&&c>.6;console.log("üîç CLASSIFICATION DEBUG - Combined confidence:",c.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Is order page?",d),console.log("üîç CLASSIFICATION DEBUG - Decision logic: keywordMatches >= 2 && combinedConfidence > 0.6"),console.log("üîç CLASSIFICATION DEBUG - Actual: keywordMatches =",s,", combinedConfidence =",c.toFixed(3));const g={isOrder:d,confidence:c,method:"distilbert-sentiment-adapted",topLabel:d?"order page":"non-order page",allPredictions:[{label:"order page",score:c},{label:"non-order page",score:1-c}],details:{model:this.modelName,keywordMatches:s,keywordConfidence:l,sentimentResult:i,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:g,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:d,confidence:c.toFixed(3),keywordMatches:s,sentiment:i[0].label}),g}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){const e=this.extractPageContent();return{...await this.classify(e),pageInfo:{url:window.location.href,title:document.title,contentLength:e.length}}}async classifyWithCustomLabels(e,o=null){this.isLoaded||await this.loadModel();const t=o||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const o=await this.classify(e);let n,r;return o.isOrder?(n=t.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||t[0],r=o.confidence):(n=t.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||t[t.length-1],r=1-o.confidence),{isOrder:o.isOrder,confidence:r,method:"distilbert-sentiment-custom",topLabel:n,allPredictions:t.map(e=>{const n=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:n===o.isOrder?r:(1-r)/(t.length-1)}}).sort((e,o)=>o.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){console.log("üîç CONTENT EXTRACTION DEBUG - Starting enhanced page content extraction"),console.log("üîç CONTENT EXTRACTION DEBUG - Current URL:",window.location.href),console.log("üîç CONTENT EXTRACTION DEBUG - Page title:",document.title);const e=["nav","header","footer","aside",'[role="navigation"]','[role="banner"]','[role="contentinfo"]',".navigation",".nav",".menu",".header",".footer",".sidebar",".advertisement",".ad",".ads",".promo",".promotion",".breadcrumb",".breadcrumbs",".tabs",".tab","script","style","noscript"],o=['[class*="order-detail"]','[id*="order-detail"]','[class*="order-summary"]','[id*="order-summary"]','[class*="order-info"]','[id*="order-info"]','[class*="invoice"]','[id*="invoice"]','[class*="receipt"]','[id*="receipt"]','[class*="confirmation"]','[id*="confirmation"]',".order",".purchase",".transaction"],t=["main",'[role="main"]',".main-content","#main-content","h1, h2, h3",".title",".price",".total",".amount"];let n="",r=0,s=!1;console.log("üîç CONTENT EXTRACTION DEBUG - Checking priority selectors...");for(const t of o){const o=document.querySelectorAll(t);o.length>0&&(console.log(`üîç CONTENT EXTRACTION DEBUG - Found ${o.length} priority elements for: ${t}`),o.forEach((o,t)=>{const i=this.cleanElementText(o,e);i.length>20&&(n+=i+" ",r++,s=!0,t<2&&console.log(`üîç CONTENT EXTRACTION DEBUG - Priority content: ${i.slice(0,100)}...`))}))}if(!s){console.log("üîç CONTENT EXTRACTION DEBUG - No priority content found, trying general selectors...");for(const o of t){const t=document.querySelectorAll(o);if(t.length>0&&(console.log(`üîç CONTENT EXTRACTION DEBUG - Found ${t.length} general elements for: ${o}`),t.forEach((o,t)=>{const i=this.cleanElementText(o,e);i.length>10&&(n+=i+" ",r++,s=!0,t<2&&console.log(`üîç CONTENT EXTRACTION DEBUG - General content: ${i.slice(0,100)}...`))})),s&&n.length>200)break}}if(console.log("üîç CONTENT EXTRACTION DEBUG - Total elements processed:",r),console.log("üîç CONTENT EXTRACTION DEBUG - Raw extracted content length:",n.length),n=this.cleanAndNormalizeText(n),console.log("üîç CONTENT EXTRACTION DEBUG - Cleaned content length:",n.length),n.length<100){console.log("üîç CONTENT EXTRACTION DEBUG - Content still too short, using filtered body text");const o=document.body.cloneNode(!0);for(const t of e)o.querySelectorAll(t).forEach(e=>e.remove());n=o.textContent||o.innerText||"",n=this.cleanAndNormalizeText(n),console.log("üîç CONTENT EXTRACTION DEBUG - Filtered body text length:",n.length)}if(n.length<50){console.log("üîç CONTENT EXTRACTION DEBUG - Still no content, trying basic fallback selectors...");const e=["body","html","[id]","[class]"];for(const o of e){const e=document.querySelectorAll(o);if(e.length>0){const t=e[0].textContent||e[0].innerText||"";if(t.length>n.length){n=this.cleanAndNormalizeText(t),console.log(`üîç CONTENT EXTRACTION DEBUG - Fallback content from ${o}: ${n.length} chars`);break}}}}(!n||n.length<10)&&(console.warn("‚ö†Ô∏è CONTENT EXTRACTION WARNING - No meaningful content found, using page title and URL"),n=`${document.title} ${window.location.href}`.trim(),(!n||n.length<5)&&(n="webpage content not available"));const i=n.slice(0,2e3);return console.log("üîç CONTENT EXTRACTION DEBUG - Final content length (after truncation):",i.length),console.log("üîç CONTENT EXTRACTION DEBUG - Final content preview (first 200 chars):",i.slice(0,200)),console.log("üîç CONTENT EXTRACTION DEBUG - Content quality check - has order keywords:",/\b(order|purchase|total|amount|price|date|customer|product|item|quantity|invoice|receipt)\b/i.test(i)),i}cleanElementText(e,o){const t=e.cloneNode(!0);for(const e of o)t.querySelectorAll(e).forEach(e=>e.remove());let n=t.textContent||"";return n=n.replace(/\s+/g," ").trim(),n}cleanAndNormalizeText(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\t\n\r\f\v]+/g," ")).replace(/\s{2,}/g," ")).replace(/\(\s*\)/g,"")).replace(/\[\s*\]/g,"")).replace(/\{\s*\}/g,"")).replace(/[.,;:!?]{2,}/g,".")).replace(/\b[a-zA-Z]\b/g,"")).replace(/\.{2,}/g,".")).replace(/-{2,}/g,"-")).replace(/\s+([.,;:!?])/g,"$1")).replace(/([.,;:!?])\s*([.,;:!?])/g,"$1")).replace(/\s+/g," ").trim()}getCacheKey(e){let o=0;for(let t=0;t<Math.min(e.length,100);t++)o=(o<<5)-o+e.charCodeAt(t),o&=o;return`distilbert_${Math.abs(o)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT-Inspired Order Classifier",model:"advanced-pattern-sentiment-classifier",type:"keyword-pattern-sentiment-analysis",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=n);const r=n}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var s=o[n]={id:n,loaded:!1,exports:{}};return e[n](s,s.exports,t),s.loaded=!0,s.exports}t.d=(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},t.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o);async function n(e,o){console.log("‚ö†Ô∏è Using fallback local extraction..."),o.extractionMethod="local-fallback";const t={orderId:[/order[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/invoice[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi],price:[/([\$‚Çπ¬£‚Ç¨¬•]\s*[\d,]+\.?\d*)/g,/total[:\s]*([\d,]+\.?\d*)/gi],email:[/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/g],date:[/\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}/g]};for(const[n,r]of Object.entries(t))for(const t of r){const r=[...e.matchAll(t)];if(r.length>0){"orderId"!==n||o.orderId?"price"!==n||o.productValue?"email"!==n||o.customerDetails.email?"date"!==n||o.orderDate||(o.orderDate=r[0][0],o.extractedFields.push("orderDate")):(o.customerDetails.email=r[0][1],o.extractedFields.push("email")):(o.productValue=r[0][1],o.extractedFields.push("productValue")):(o.orderId=r[0][1],o.extractedFields.push("orderId"));break}}o.confidence=.1*o.extractedFields.length}function r(e){const o=[];return[/\b(amazon|flipkart|myntra|ebay|etsy|shopify|walmart|target|alibaba|aliexpress)\b/gi,/\b([A-Z][a-z]+ (?:Inc|Corp|Ltd|LLC|Company|Co|Store|Shop|Market|Mart))\b/g,/(?:sold by|shipped by|from)\s+([A-Z][a-zA-Z\s]{2,30})/gi].forEach(t=>{[...e.matchAll(t)].forEach(e=>o.push(e[1]||e[0]))}),[...new Set(o)].slice(0,10)}function s(e){const o=[];return[/[\$‚Çπ¬£‚Ç¨¬•]\s*[\d,]+\.?\d*/g,/[\d,]+\.?\d*\s*[\$‚Çπ¬£‚Ç¨¬•]/g,/(?:rs|inr|usd|eur|gbp|jpy)\s*[\.\s]?\s*[\d,]+\.?\d*/gi,/(?:total|price|amount|cost|value)\s*:?\s*([\$‚Çπ¬£‚Ç¨¬•]?\s*[\d,]+\.?\d*)/gi].forEach(t=>{[...e.matchAll(t)].forEach(e=>o.push(e[1]||e[0]))}),[...new Set(o)].slice(0,5)}function i(e){const o=[];return[/\b\d{1,2}[-\/]\d{1,2}[-\/]\d{2,4}\b/g,/\b\d{4}-\d{2}-\d{2}\b/g,/\b\d{1,2}\s+(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*\s+\d{4}\b/gi,/\b(january|february|march|april|may|june|july|august|september|october|november|december)\s+\d{1,2},?\s+\d{4}\b/gi].forEach(t=>{[...e.matchAll(t)].forEach(e=>o.push(e[0]))}),[...new Set(o)].slice(0,5)}function l(e){return[...e.matchAll(/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g)].map(e=>e[0]).slice(0,3)}function a(e){const o=[];return[/(?:\+91|0)?\s*[6789]\d{9}/g,/(?:\+1)?\s*\d{10}/g,/(?:\+44)?\s*\d{10,11}/g].forEach(t=>{[...e.matchAll(t)].forEach(e=>o.push(e[0]))}),[...new Set(o)].slice(0,3)}function c(e){const o=[];return[/\b\d{6,20}\b/g,/\b[A-Z]{2,4}\d{6,15}\b/g,/\b\d+\.\d{2}\b/g].forEach(t=>{[...e.matchAll(t)].forEach(e=>o.push(e[0]))}),[...new Set(o)].slice(0,10)}function d(e){const o=[];return[/(?:product|item)\s*(?:name|title)?\s*:?\s*([^\n\r]{10,100})/gi,/(?:bought|purchased|ordered)\s*:?\s*([^\n\r]{10,100})/gi,/<h1[^>]*>([^<]{10,100})<\/h1>/gi,/(?:you\s*(?:bought|ordered))\s*:?\s*([^\n\r]{10,100})/gi].forEach(t=>{[...e.matchAll(t)].forEach(e=>{const t=(e[1]||e[0]).trim().replace(/[<>]/g,"").replace(/\s+/g," ");t.length>=10&&t.length<=100&&o.push(t)})}),[...new Set(o)].slice(0,5)}function g(e){const o=[];return[/order[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/invoice[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/confirmation[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/order\s*(?:number|id)\s*:?\s*([A-Z0-9\-]{6,25})/gi,/\b([A-Z]{2,4}[\-]?\d{8,15})\b/g,/\b(\d{10,15})\b/g].forEach(t=>{[...e.matchAll(t)].forEach(e=>{const t=e[1]||e[0];t.length>=6&&t.length<=25&&o.push(t)})}),[...new Set(o)].slice(0,5)}var u=t(481);console.log("AutoComplaint: Universal E-commerce Order Extractor v9.0 (NER-based)");let h=u.A;h||"undefined"==typeof window||(h=window.DistilBERTMNLIClassifier);const m=h||u.A,f={CONFIDENCE_THRESHOLD:.7,DEBUG_MODE:!0,CACHE_DURATION:3e5};let p={distilbertClassifier:null},E=!1;const T=new Map;async function C(){if(E)return p;try{console.log("ü§ñ Initializing standalone DistilBERT MNLI classifier..."),console.log("üß† Loading DistilBERT MNLI classifier...");try{if(!m)throw new Error("DistilBERT MNLI Classifier not available");p.distilbertClassifier=new m,await p.distilbertClassifier.loadModel(),console.log("‚úÖ DistilBERT MNLI classifier loaded successfully")}catch(e){throw console.error("‚ùå DistilBERT MNLI classifier failed to load:",e.message),e}return E=!0,console.log("ÔøΩ Standalone ML model initialization completed"),p}catch(e){return console.error("‚ùå Failed to initialize ML models:",e),E=!0,p}}async function N(){try{const e=window.location.href;if(console.log("üîç ANALYSIS START - Checking if page is an order page"),console.log("üîç ANALYSIS - Current URL:",e),console.log("üîç ANALYSIS - Page title:",document.title),console.log("üîç ANALYSIS - Domain:",window.location.hostname),T.has(e)){const o=T.get(e);if(Date.now()-o.timestamp<f.CACHE_DURATION)return console.log("üìã CACHE HIT - Using cached classification:",o.result),o.result.isOrder}E||(console.log("üîÑ MODELS - Initializing ML models..."),await C()),console.log("üìÑ CONTENT - Extracting page content...");const o=A();let t;console.log("üìÑ CONTENT - Extracted text length:",o.length),console.log("üìÑ CONTENT - First 300 characters:",o.slice(0,300));try{console.log("ü§ñ CLASSIFICATION - Starting ML classification..."),t=await async function(e){try{if(!p.distilbertClassifier)throw new Error("DistilBERT MNLI classifier not available");console.log("üß† Using DistilBERT MNLI for classification...");const o=await p.distilbertClassifier.classify(e);return console.log("ü§ñ DistilBERT MNLI Result:",{isOrder:o.isOrder,confidence:o.confidence.toFixed(3),topLabel:o.topLabel}),{isOrder:o.isOrder,confidence:o.confidence,method:"distilbert-mnli",details:o}}catch(e){throw console.error("‚ùå DistilBERT MNLI classification failed:",e.message),e}}(o),console.log("ü§ñ CLASSIFICATION - ML result:",t)}catch(e){return console.error("‚ùå CLASSIFICATION - ML classification failed:",e),console.warn("‚ö†Ô∏è ML classification unavailable, cannot proceed without ML models"),!1}T.set(e,{result:t,timestamp:Date.now()}),console.log("üíæ CACHE - Result cached for future use"),function(){const e=Date.now();for(const[o,t]of T.entries())e-t.timestamp>f.CACHE_DURATION&&T.delete(o)}(),f.DEBUG_MODE&&console.log("üéØ Page Classification Result:",{url:e.substring(0,100),isOrder:t.isOrder,confidence:(100*t.confidence).toFixed(1)+"%",method:t.method});const n=t.isOrder&&t.confidence>=f.CONFIDENCE_THRESHOLD;return n&&console.log(`‚úÖ Order page detected with ${(100*t.confidence).toFixed(1)}% confidence`),n}catch(e){return console.error("‚ùå Order page classification failed:",e),!1}}function A(){console.log("üìÑ TEXT EXTRACTION - Starting universal, adaptive content extraction..."),console.log("üìÑ TEXT EXTRACTION - Domain:",window.location.hostname),console.log("üìÑ TEXT EXTRACTION - Page title:",document.title);const e=["nav","header","footer","aside",'[role="navigation"]','[role="banner"]','[role="contentinfo"]',".navigation",".nav",".menu",".header",".footer",".sidebar",".advertisement",".ad",".ads",".promo",".promotion",".banner",".breadcrumb",".breadcrumbs",".tabs",".tab",".pagination",".social-share",".social",".newsletter",".subscription",".cookie-notice",".popup",".modal",".overlay",".spinner",".loading",".skeleton",".placeholder",".tooltip","script","style","noscript","iframe","embed","object"],o=['[class*="order"]','[id*="order"]','[class*="purchase"]','[id*="purchase"]','[class*="invoice"]','[id*="invoice"]','[class*="receipt"]','[id*="receipt"]','[class*="confirmation"]','[id*="confirmation"]','[class*="transaction"]','[id*="transaction"]','[class*="detail"]','[id*="detail"]','[class*="summary"]','[id*="summary"]','[class*="info"]','[id*="info"]','[class*="checkout"]','[id*="checkout"]','[class*="cart"]','[id*="cart"]','[class*="basket"]','[id*="basket"]','[class*="payment"]','[id*="payment"]','[class*="billing"]','[id*="billing"]','[class*="shipping"]','[id*="shipping"]'],t=["main",'[role="main"]',".main","#main",".content","#content",".main-content","#main-content",".container",".wrapper",".page",".body-content","article","section"];let n="",r=[];console.log("üìÑ TEXT EXTRACTION - Phase 1: Searching order-specific content...");for(const t of o)try{const o=document.querySelectorAll(t);if(o.length>0){console.log(`üìÑ TEXT EXTRACTION - Found ${o.length} elements for: ${t}`);for(const s of o){if(s.offsetHeight<10||s.offsetWidth<10)continue;const o=O(s,e);o.length>30&&(n+=o+" ",r.push(t),console.log(`üìÑ TEXT EXTRACTION - Added content from ${t}: ${o.slice(0,100)}...`))}}}catch(e){console.warn(`üìÑ TEXT EXTRACTION - Error with selector ${t}:`,e.message)}if(n.length<200){console.log("üìÑ TEXT EXTRACTION - Phase 2: Limited content found, trying fallback selectors...");for(const o of t)try{const t=document.querySelectorAll(o);if(t.length>0){console.log(`üìÑ TEXT EXTRACTION - Found ${t.length} fallback elements for: ${o}`);for(const s of t){const t=O(s,e);if(t.length>50){n+=t+" ",r.push(o),console.log(`üìÑ TEXT EXTRACTION - Added fallback content from ${o}: ${t.slice(0,100)}...`);break}}if(n.length>500)break}}catch(e){console.warn(`üìÑ TEXT EXTRACTION - Error with fallback selector ${o}:`,e.message)}}if(console.log("üìÑ TEXT EXTRACTION - Phase 3: Content analysis and filtering..."),n=b(n),!n||n.length<20){console.warn("‚ö†Ô∏è TEXT EXTRACTION - Phase 4: Minimal content found, using enhanced fallback...");const o=O(document.body,e),t=document.title||"",s=window.location.href||"";n=`${t} ${o} ${s}`.trim(),n=b(n),r.push("ultimate-fallback"),(!n||n.length<10)&&(n=`Page title: ${t||"Unknown"} URL: ${s||"Unknown"}`,console.warn("‚ö†Ô∏è TEXT EXTRACTION - Using minimal fallback content"))}n.length>8e3&&(n=n.substring(0,8e3),console.log("üìÑ TEXT EXTRACTION - Content truncated to 8000 characters"));const s=["order","purchase","total","amount","price","date","customer","product","item","quantity","invoice","receipt","shipping","billing"].filter(e=>n.toLowerCase().includes(e));return console.log("üìÑ TEXT EXTRACTION - Final content analysis:",{contentLength:n.length,contentSources:[...new Set(r)],foundOrderKeywords:s,keywordCount:s.length,contentQuality:s.length>2?"Good":s.length>0?"Fair":"Poor"}),console.log("üìÑ TEXT EXTRACTION - Content preview (first 300 chars):",n.slice(0,300)),n}function O(e,o){const t=e.cloneNode(!0);for(const e of o)t.querySelectorAll(e).forEach(e=>e.remove());let n=t.textContent||"";return n=n.replace(/\s+/g," ").trim(),n}function b(e){return console.log("üìÑ TEXT CLEANING - Starting advanced text cleanup..."),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\t\n\r\f\v]+/g," ")).replace(/\s{2,}/g," ")).replace(/\(\s*\)/g,"")).replace(/\[\s*\]/g,"")).replace(/\{\s*\}/g,"")).replace(/[.,;:!?]{2,}/g,".")).replace(/\b[a-zA-Z]\b/g,"")).replace(/\.{2,}/g,".")).replace(/-{2,}/g,"-")).replace(/\s+([.,;:!?])/g,"$1")).replace(/([.,;:!?])\s*([.,;:!?])/g,"$1")).replace(/\s+/g," ").trim(),console.log("üìÑ TEXT CLEANING - Text cleanup completed"),e}async function w(){try{console.log("üîç ORDER CHECK - Verifying if page contains order information...");const e=await N();if(console.log("üîç ORDER CHECK - Is order page result:",e),!e)return console.log("‚è≠Ô∏è ORDER CHECK - Not an order page, skipping extraction"),console.log("üí° ORDER CHECK - If this should be an order page, check the classification logic"),null;console.log("üì¶ ORDER EXTRACTION - Starting ML-based order information extraction..."),E||(console.log("ü§ñ MODEL CHECK - Models not ready, initializing..."),await C()),console.log("üìÑ CONTENT PREP - Extracting page content for ML processing...");const o=A();console.log("üìÑ CONTENT PREP - Content length:",o.length),console.log("üìÑ CONTENT PREP - Content preview:",o.slice(0,200)),console.log("ü§ñ ML EXTRACTION - Running ML-based order info extraction...");const t=await async function(e){console.log("ÔøΩ Starting NER-based universal order extraction..."),console.log("üìä Content length:",e.length);try{const o=await async function(e,o=""){const t={orderId:"",productName:"",productValue:"",orderDate:"",deliveryDate:"",sellerName:"",trackingNumber:"",customerDetails:{},extractionMethod:"ner-based",confidence:0,url:o,domain:o?new URL(o).hostname:"unknown",extractedFields:[],nerEntities:{},serverAvailable:!1};try{console.log("üß† Starting NER-based extraction for domain:",t.domain);const o=await async function(e){try{console.log("üîç Using OOB NER models for entity extraction...");const o={organizations:r(e),money:s(e),dates:i(e),emails:l(e),phoneNumbers:a(e),numbers:c(e),products:d(e),orderIds:g(e),timestamp:(new Date).toISOString()};return console.log("‚úÖ OOB NER extraction completed:",o),o}catch(e){return console.error("‚ùå Failed to extract entities with OOB models:",e),{error:e.message}}}(e);return o&&!o.error?(t.nerEntities=o,t.serverAvailable=!1,console.log("‚úÖ NER entities extracted using OOB models:",o),await async function(e,o,t){console.log("üîç NER Order ID extraction...");const n=[/order[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/invoice[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/confirmation[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/reference[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi,/transaction[#\s]*:?\s*([A-Z0-9\-]{6,25})/gi];let r=null,s=0;for(const o of n){const n=[...e.matchAll(o)];for(const o of n){let n=.4;const i=o[0].toLowerCase(),l=o[1];i.includes("order")&&(n+=.5),i.includes("invoice")&&(n+=.4),i.includes("confirmation")&&(n+=.3),l.length>=8&&(n+=.3),/[A-Z]/.test(l)&&/\d/.test(l)&&(n+=.2),l.includes("-")&&(n+=.1),t.organizations&&t.organizations.length>0&&t.organizations.some(o=>Math.abs(e.toLowerCase().indexOf(l.toLowerCase())-e.toLowerCase().indexOf(o.toLowerCase()))<200)&&(n+=.2),n>s&&(s=n,r=l)}}r&&s>.5&&(o.orderId=r,o.confidence+=.3,o.extractedFields.push("orderId"),console.log("‚úÖ Order ID found via NER:",r))}(e,t,o),await async function(e,o,t){console.log("üîç NER Product Name extraction...");let n=[];if(t.nouns&&t.nouns.length>0){const o=["product","item","book","phone","laptop","shirt","shoes","watch","bag"];for(const r of t.nouns)if(r.length>5&&r.length<100){let t=.1;for(const e of o)if(r.toLowerCase().includes(e)){t+=.4;break}if(/(?:buy|bought|purchase|order)/.test(e.toLowerCase())){const o=e.toLowerCase().search(/(?:buy|bought|purchase|order)/),n=e.toLowerCase().indexOf(r.toLowerCase());Math.abs(o-n)<100&&(t+=.3)}n.push({name:r,score:t})}}const r=e.match(/"([^"]{5,100})"/g);if(r)for(const e of r){const o=e.replace(/"/g,"");n.push({name:o,score:.6})}const s=[...e.matchAll(/\b([A-Z][a-z]+(?:\s+[A-Z][a-z]+){1,5})\b/g)];for(const e of s)e[1].length>5&&e[1].length<100&&n.push({name:e[1],score:.4});if(n.length>0){const e=n.reduce((e,o)=>o.score>e.score?o:e);e.score>.3&&(o.productName=e.name.trim(),o.confidence+=.2,o.extractedFields.push("productName"),console.log("‚úÖ Product name found via NER:",e.name))}}(e,t,o),await async function(e,o,t){if(console.log("üîç NER Price extraction..."),t.money&&t.money.length>0){let n=null,r=0;for(const o of t.money){let t=.3;const s=e.toLowerCase().indexOf(o.toLowerCase()),i=e.substring(Math.max(0,s-50),s).toLowerCase();i.includes("total")&&(t+=.5),i.includes("price")&&(t+=.4),i.includes("cost")&&(t+=.3),i.includes("amount")&&(t+=.3),i.includes("paid")&&(t+=.4),(i.includes("shipping")||i.includes("tax"))&&(t-=.3),t>r&&(r=t,n=o)}n&&r>.4&&(o.productValue=n,o.confidence+=.25,o.extractedFields.push("productValue"),console.log("‚úÖ Price found via NER:",n))}}(e,t,o),await async function(e,o,t){if(console.log("üîç NER Date extraction..."),t.dates&&t.dates.length>0){let n=null,r=null;for(const o of t.dates){const t=e.toLowerCase().indexOf(o.toLowerCase()),s=e.substring(Math.max(0,t-30),t).toLowerCase();s.includes("order")||s.includes("purchase")||s.includes("placed")||s.includes("confirmed")?n||(n=o):s.includes("delivery")||s.includes("shipping")||s.includes("arrive")||s.includes("expected")?r||(r=o):n||(n=o)}n&&(o.orderDate=n,o.confidence+=.2,o.extractedFields.push("orderDate"),console.log("‚úÖ Order date found via NER:",n)),r&&(o.deliveryDate=r,o.confidence+=.15,o.extractedFields.push("deliveryDate"),console.log("‚úÖ Delivery date found via NER:",r))}}(e,t,o),await async function(e,o,t){if(console.log("üîç NER Seller extraction..."),t.organizations&&t.organizations.length>0){let n=null,r=0;for(const o of t.organizations){let t=.3;const s=e.toLowerCase().indexOf(o.toLowerCase()),i=e.substring(Math.max(0,s-50),s).toLowerCase(),l=e.substring(s,Math.min(e.length,s+50)).toLowerCase();(i.includes("sold by")||l.includes("seller"))&&(t+=.5),(i.includes("from")||i.includes("by"))&&(t+=.3),(i.includes("brand")||i.includes("manufacturer"))&&(t+=.4),["amazon","flipkart","myntra","ebay","etsy"].some(e=>o.toLowerCase().includes(e))&&(t+=.2),t>r&&o.length>2&&o.length<50&&(r=t,n=o)}n&&r>.4&&(o.sellerName=n,o.confidence+=.15,o.extractedFields.push("sellerName"),console.log("‚úÖ Seller found via NER:",n))}}(e,t,o),await async function(e,o,t){console.log("üîç NER Contact info extraction..."),t.emails&&t.emails.length>0&&(o.customerDetails.email=t.emails[0],o.confidence+=.1,o.extractedFields.push("email"),console.log("‚úÖ Email found via NER:",t.emails[0])),t.phoneNumbers&&t.phoneNumbers.length>0&&(o.customerDetails.phone=t.phoneNumbers[0],o.confidence+=.1,o.extractedFields.push("phone"),console.log("‚úÖ Phone found via NER:",t.phoneNumbers[0]))}(0,t,o),await async function(e,o,t){console.log("üîç Custom E-commerce entity extraction...");const n=[/(?:tracking|awb|shipment)\s*(?:number|id|code)?\s*:?\s*([A-Z0-9]{8,25})/gi,/track\s*:?\s*([A-Z0-9]{8,25})/gi];for(const t of n){const n=[...e.matchAll(t)];if(n.length>0){o.trackingNumber=n[0][1],o.confidence+=.1,o.extractedFields.push("trackingNumber"),console.log("‚úÖ Tracking number found:",n[0][1]);break}}if(t.numbers&&t.numbers.length>0){const t=/(\d+)\s*(item|items|piece|pieces|qty|quantity)/gi,n=[...e.matchAll(t)];n.length>0&&(o.quantity=n[0][0],o.confidence+=.05,o.extractedFields.push("quantity"),console.log("‚úÖ Quantity found:",n[0][0]))}t.places&&t.places.length>0&&(o.customerDetails.address=t.places.join(", "),o.confidence+=.05,o.extractedFields.push("address"),console.log("‚úÖ Address found via NER:",t.places.join(", ")))}(e,t,o)):(console.log("‚ö†Ô∏è OOB extraction failed, falling back to basic patterns"),await n(e,t)),function(e){e.extractedFields.length>=3&&(e.confidence+=.1),e.extractedFields.length>=5&&(e.confidence+=.1),e.serverAvailable&&(e.confidence+=.05),["amazon","flipkart","myntra","ebay","etsy","shopify"].some(o=>e.domain.includes(o))&&(e.confidence+=.05),e.confidence=Math.min(1,Math.max(0,e.confidence))}(t),console.log("‚úÖ NER extraction completed:",{fieldsFound:t.extractedFields.length,confidence:t.confidence.toFixed(3),oobModelsUsed:!0}),t}catch(o){console.error("‚ùå NER extraction error:",o),t.error=o.message;try{await n(e,t)}catch(e){console.error("‚ùå Fallback extraction also failed:",e)}return t}}(e,window.location.href);return console.log("‚úÖ NER extraction completed:",{fieldsFound:o.extractedFields.length,fields:o.extractedFields,confidence:o.confidence.toFixed(3),serverUsed:o.serverAvailable}),o}catch(e){return console.error("‚ùå NER extraction failed:",e),{orderId:"",productName:"",productValue:"",orderDate:"",deliveryDate:"",sellerName:"",trackingNumber:"",customerDetails:{},extractionMethod:"error-fallback",confidence:0,url:window.location.href,domain:window.location.hostname,extractedFields:[],error:e.message}}}(o);return console.log("ü§ñ ML EXTRACTION - Raw ML result:",t),t?(console.log("‚úÖ ORDER SUCCESS - Order extracted successfully:",t),console.log("üìä ORDER SUMMARY - Extracted fields:",Object.keys(t)),t.orderId&&console.log("üìã ORDER DETAIL - Order ID found:",t.orderId),t.total&&console.log("üí∞ ORDER DETAIL - Total found:",t.total),t.items&&console.log("üì¶ ORDER DETAIL - Items found:",t.items.length),t.date&&console.log("üìÖ ORDER DETAIL - Date found:",t.date),t):(console.warn("‚ö†Ô∏è ORDER EMPTY - No order information could be extracted"),console.warn("üí° TROUBLESHOOT - Check if page has expected order elements or adjust selectors"),null)}catch(e){return console.error("‚ùå ORDER ERROR - Order extraction failed:",e),console.error("‚ùå ORDER ERROR - Stack trace:",e.stack),null}}async function y(){try{console.log("üöÄ EXTRACTION START - AutoComplaint ML extraction process"),console.log("üîç EXTRACTION - Current URL:",window.location.href),console.log("üîç EXTRACTION - Page title:",document.title),console.log("üîç EXTRACTION - Domain:",window.location.hostname),console.log("üîç EXTRACTION - Timestamp:",(new Date).toISOString()),console.log("üìã PAGE ANALYSIS - Analyzing page structure...");const o=function(){const e={url:window.location.href,domain:window.location.hostname,title:document.title,hasOrderKeywords:!1,orderKeywords:[],elementCounts:{},hasOrderElements:!1,orderElements:[],suspectedOrderPage:!1},o=(document.title+" "+window.location.href).toLowerCase();e.orderKeywords=["order","purchase","receipt","invoice","confirmation","thank you","checkout"].filter(e=>o.includes(e)),e.hasOrderKeywords=e.orderKeywords.length>0;const t=[".order",".order-details",".order-summary",".order-info",".receipt",".invoice",".confirmation",".purchase-summary",'[class*="order"]','[id*="order"]','[class*="receipt"]','[id*="receipt"]'];for(const o of t){const t=document.querySelectorAll(o);t.length>0&&(e.orderElements.push({selector:o,count:t.length}),e.elementCounts[o]=t.length)}return e.hasOrderElements=e.orderElements.length>0,e.elementCounts.headings=document.querySelectorAll("h1, h2, h3").length,e.elementCounts.forms=document.querySelectorAll("form").length,e.elementCounts.tables=document.querySelectorAll("table").length,e.elementCounts.lists=document.querySelectorAll("ul, ol").length,e.elementCounts.images=document.querySelectorAll("img").length,e.suspectedOrderPage=e.hasOrderKeywords||e.hasOrderElements,e}();console.log("üìã PAGE ANALYSIS - Results:",o),console.log("ü§ñ MODEL INIT - Initializing ML models..."),await C(),console.log("ü§ñ MODEL INIT - ML models ready"),console.log("üì¶ DATA EXTRACTION - Starting order data extraction...");const t=await w();var e;return console.log("üì¶ DATA EXTRACTION - Raw extraction result:",t),t?(console.log("‚úÖ EXTRACTION SUCCESS - Order data extracted:",t),console.log("üìä EXTRACTION STATS - Fields found:",Object.keys(t).length),console.log("üìä EXTRACTION STATS - Has order ID:",!!t.orderId),console.log("üìä EXTRACTION STATS - Has total:",!!t.total),console.log("üìä EXTRACTION STATS - Has items:",!(null===(e=t.items)||void 0===e||!e.length)),"undefined"!=typeof chrome&&chrome.storage?chrome.storage.local.set({autoComplaintOrder:t},()=>{chrome.runtime.lastError?console.error("‚ùå STORAGE ERROR:",chrome.runtime.lastError):console.log("‚úÖ STORAGE SUCCESS - Order data saved to chrome storage")}):console.log("üìã STORAGE SKIP - Chrome storage not available, data extracted only"),t):(console.log("‚ö†Ô∏è EXTRACTION EMPTY - No order data could be extracted from this page"),console.log("üîç TROUBLESHOOT - Page might not be an order page or selectors need adjustment"),null)}catch(e){return console.error("‚ùå EXTRACTION ERROR - Full extraction process failed:",e),console.error("‚ùå EXTRACTION ERROR - Stack trace:",e.stack),null}}async function R(){try{console.log("ÔøΩ Starting universal order extraction...");const e=await y();if(e){console.log("‚úÖ Universal extraction completed:",e);try{chrome.runtime.sendMessage({type:"EXTRACTION_COMPLETE",data:e,url:window.location.href})}catch(e){console.warn("‚ö†Ô∏è Could not send message to extension:",e)}}else console.log("‚ÑπÔ∏è No order data found on this page")}catch(e){console.error("‚ùå Universal extraction failed:",e)}}console.log("üèÅ AutoComplaint ML extension loaded, starting extraction..."),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y(),function(){let e=window.location.href;new MutationObserver(()=>{window.location.href!==e&&(e=window.location.href,console.log("üîÑ Page URL changed, re-running extraction..."),setTimeout(y,1e3))}).observe(document.body,{subtree:!0,childList:!0})}(),"undefined"!=typeof window&&(window.AutoComplaint={extractOrderInfo:w,isOrderPage:N,initializeMLModels:C,initializeExtraction:y,models:p,CONFIG:f}),console.log("üöÄ AutoComplaint Universal Extractor v7.0 - ML-Based"),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",R):R();let I=window.location.href;new MutationObserver(()=>{window.location.href!==I&&(I=window.location.href,console.log("ÔøΩ URL changed, re-running extraction..."),setTimeout(R,1e3))}).observe(document.body,{subtree:!0,childList:!0}),"undefined"!=typeof window&&(window.AutoComplaintUniversalExtractor={startUniversalExtraction:R,lastUrl:I}),chrome.runtime.onMessage.addListener((e,o,t)=>{if("extractOrderData"===e.action)return console.log("üì• Received extraction request"),(async()=>{try{const e=await y();t({success:!0,data:e})}catch(e){console.error("‚ùå Requested extraction failed:",e),t({success:!1,error:e.message})}})(),!0})})();