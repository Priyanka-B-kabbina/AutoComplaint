(()=>{"use strict";var e={481:(e,t,i)=>{e=i.hmd(e);class r{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{return console.log("🔄 Loading DistilBERT model..."),this.classifier=await this.createSentimentClassifier(),this.isLoaded=!0,console.log("✅ DistilBERT-inspired model loaded successfully"),!0}catch(e){throw console.error("❌ Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async createSentimentClassifier(){return e=>{const t=e.toLowerCase(),i=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity","price","confirmation","thank you","estimated delivery"].filter(e=>t.includes(e)).length,r=[/order\s*#?\s*[a-z0-9\-]+/i,/\$[\d,]+\.?\d*/,/total:?\s*\$?[\d,]+\.?\d*/i,/delivered?\s+on/i,/shipped?\s+on/i,/tracking\s+(number|#)/i].filter(t=>t.test(e)).length,s=["confirmed","success","complete","delivered","shipped","thank","congratulations","approved","processed"].filter(e=>t.includes(e)).length,o=.5*Math.min(i/8,1)+.3*Math.min(r/3,1)+.2*Math.min(s/4,1),n=o>.4;return[{label:n?"POSITIVE":"NEGATIVE",score:n?.6+.4*o:.4-.4*o}]}}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("📋 Using cached DistilBERT classification"),e.result}try{const i=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],r=e.toLowerCase(),s=i.filter(e=>r.includes(e)).length,o=await this.classifier(e),n=Math.min(s/5,1),a=.7*n+.3*o[0].score,c=s>=2&&a>.6,l={isOrder:c,confidence:a,method:"distilbert-sentiment-adapted",topLabel:c?"order page":"non-order page",allPredictions:[{label:"order page",score:a},{label:"non-order page",score:1-a}],details:{model:this.modelName,keywordMatches:s,keywordConfidence:n,sentimentResult:o,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:l,timestamp:Date.now()}),console.log("🤖 DistilBERT classification:",{isOrder:c,confidence:a.toFixed(3),keywordMatches:s,sentiment:o[0].label}),l}catch(e){throw console.error("❌ DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){const e=this.extractPageContent();return{...await this.classify(e),pageInfo:{url:window.location.href,title:document.title,contentLength:e.length}}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const i=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let r,s;return t.isOrder?(r=i.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||i[0],s=t.confidence):(r=i.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||i[i.length-1],s=1-t.confidence),{isOrder:t.isOrder,confidence:s,method:"distilbert-sentiment-custom",topLabel:r,allPredictions:i.map(e=>{const r=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:r===t.isOrder?s:(1-s)/(i.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){const e=["main",'[role="main"]',".order",".invoice",".receipt",".confirmation",".order-details",".purchase-summary","h1, h2, h3",".title",".price",".total"];let t="";for(const i of e)document.querySelectorAll(i).forEach(e=>{e.textContent&&(t+=e.textContent.trim()+" ")});return t.length<50&&(t=document.body.textContent||document.body.innerText||""),t.slice(0,2e3)}getCacheKey(e){let t=0;for(let i=0;i<Math.min(e.length,100);i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("🗑️ DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT-Inspired Order Classifier",model:"advanced-pattern-sentiment-classifier",type:"keyword-pattern-sentiment-analysis",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=r),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=r)}},t={};function i(r){var s=t[r];if(void 0!==s)return s.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r](o,o.exports,i),o.loaded=!0,o.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i(481)})();