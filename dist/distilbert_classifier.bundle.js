(()=>{"use strict";var e,t,i={481:(e,t,i)=>{e=i.hmd(e);class r{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{let e;if(console.log("üîÑ Loading DistilBERT model..."),"undefined"!=typeof window&&window.pipeline)e=window.pipeline;else{const{pipeline:t}=await i.e(365).then(i.bind(i,365));e=t,"undefined"!=typeof window&&(window.pipeline=e)}return this.classifier=await e("sentiment-analysis",this.modelName),this.isLoaded=!0,console.log("‚úÖ DistilBERT model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const i=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],r=e.toLowerCase(),o=i.filter(e=>r.includes(e)).length,n=await this.classifier(e),s=Math.min(o/5,1),a=.7*s+.3*n[0].score,c=o>=2&&a>.6,l={isOrder:c,confidence:a,method:"distilbert-sentiment-adapted",topLabel:c?"order page":"non-order page",allPredictions:[{label:"order page",score:a},{label:"non-order page",score:1-a}],details:{model:this.modelName,keywordMatches:o,keywordConfidence:s,sentimentResult:n,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:l,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:c,confidence:a.toFixed(3),keywordMatches:o,sentiment:n[0].label}),l}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){const e=this.extractPageContent();return{...await this.classify(e),pageInfo:{url:window.location.href,title:document.title,contentLength:e.length}}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const i=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let r,o;return t.isOrder?(r=i.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||i[0],o=t.confidence):(r=i.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||i[i.length-1],o=1-t.confidence),{isOrder:t.isOrder,confidence:o,method:"distilbert-sentiment-custom",topLabel:r,allPredictions:i.map(e=>{const r=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:r===t.isOrder?o:(1-o)/(i.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){const e=["main",'[role="main"]',".order",".invoice",".receipt",".confirmation",".order-details",".purchase-summary","h1, h2, h3",".title",".price",".total"];let t="";for(const i of e)document.querySelectorAll(i).forEach(e=>{e.textContent&&(t+=e.textContent.trim()+" ")});return t.length<50&&(t=document.body.textContent||document.body.innerText||""),t.slice(0,2e3)}getCacheKey(e){let t=0;for(let i=0;i<Math.min(e.length,100);i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT Order Classifier",model:this.modelName,type:"sentiment-analysis-transformers",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=r),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=r)}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,loaded:!1,exports:{}};return i[e](n,n.exports,o),n.loaded=!0,n.exports}o.m=i,o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce((t,i)=>(o.f[i](e,t),t),[])),o.u=e=>e+".bundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="autocomplaint-extension:",o.l=(i,r,n,s)=>{if(e[i])e[i].push(r);else{var a,c;if(void 0!==n)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var h=l[d];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+n){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",t+n),a.src=i),e[i]=[r];var u=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var o=e[i];if(delete e[i],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach(e=>e(r)),t)return t(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),c&&document.head.appendChild(a)}},(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var r=i.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=i[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={947:0};o.f.j=(t,i)=>{var r=o.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else{var n=new Promise((i,o)=>r=e[t]=[i,o]);i.push(r[2]=n);var s=o.p+o.u(t),a=new Error;o.l(s,i=>{if(o.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var n=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+n+": "+s+")",a.name="ChunkLoadError",a.type=n,a.request=s,r[1](a)}},"chunk-"+t,t)}};var t=(t,i)=>{var r,n,[s,a,c]=i,l=0;if(s.some(t=>0!==e[t])){for(r in a)o.o(a,r)&&(o.m[r]=a[r]);c&&c(o)}for(t&&t(i);l<s.length;l++)n=s[l],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0},i=self.webpackChunkautocomplaint_extension=self.webpackChunkautocomplaint_extension||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),o(481)})();