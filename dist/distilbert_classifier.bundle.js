(()=>{"use strict";var e={481:(e,t,o)=>{e=o.hmd(e);class n{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{return console.log("üîÑ Loading DistilBERT model..."),this.classifier=await this.createSentimentClassifier(),this.isLoaded=!0,console.log("‚úÖ DistilBERT-inspired model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async createSentimentClassifier(){return e=>{const t=e.toLowerCase(),o=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity","price","confirmation","thank you","estimated delivery"].filter(e=>t.includes(e)).length,n=[/order\s*#?\s*[a-z0-9\-]+/i,/\$[\d,]+\.?\d*/,/total:?\s*\$?[\d,]+\.?\d*/i,/delivered?\s+on/i,/shipped?\s+on/i,/tracking\s+(number|#)/i].filter(t=>t.test(e)).length,i=["confirmed","success","complete","delivered","shipped","thank","congratulations","approved","processed"].filter(e=>t.includes(e)).length,r=.5*Math.min(o/8,1)+.3*Math.min(n/3,1)+.2*Math.min(i/4,1),s=r>.4;return[{label:s?"POSITIVE":"NEGATIVE",score:s?.6+.4*r:.4-.4*r}]}}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");console.log("üîç CLASSIFICATION DEBUG - Input text length:",e.length),console.log("üîç CLASSIFICATION DEBUG - First 200 chars:",e.slice(0,200));const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const o=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],n=e.toLowerCase(),i=o.filter(e=>n.includes(e)),r=i.length;console.log("üîç CLASSIFICATION DEBUG - Found keywords:",i),console.log("üîç CLASSIFICATION DEBUG - Keyword matches:",r);const s=await this.classifier(e);console.log("üîç CLASSIFICATION DEBUG - Sentiment result:",s);const l=Math.min(r/5,1),c=s[0].score;console.log("üîç CLASSIFICATION DEBUG - Keyword confidence:",l.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Sentiment confidence:",c.toFixed(3));const a=.7*l+.3*c,d=r>=2&&a>.6;console.log("üîç CLASSIFICATION DEBUG - Combined confidence:",a.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Is order page?",d),console.log("üîç CLASSIFICATION DEBUG - Decision logic: keywordMatches >= 2 && combinedConfidence > 0.6"),console.log("üîç CLASSIFICATION DEBUG - Actual: keywordMatches =",r,", combinedConfidence =",a.toFixed(3));const h={isOrder:d,confidence:a,method:"distilbert-sentiment-adapted",topLabel:d?"order page":"non-order page",allPredictions:[{label:"order page",score:a},{label:"non-order page",score:1-a}],details:{model:this.modelName,keywordMatches:r,keywordConfidence:l,sentimentResult:s,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:h,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:d,confidence:a.toFixed(3),keywordMatches:r,sentiment:s[0].label}),h}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){const e=this.extractPageContent();return{...await this.classify(e),pageInfo:{url:window.location.href,title:document.title,contentLength:e.length}}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const o=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let n,i;return t.isOrder?(n=o.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||o[0],i=t.confidence):(n=o.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||o[o.length-1],i=1-t.confidence),{isOrder:t.isOrder,confidence:i,method:"distilbert-sentiment-custom",topLabel:n,allPredictions:o.map(e=>{const n=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:n===t.isOrder?i:(1-i)/(o.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){console.log("üîç CONTENT EXTRACTION DEBUG - Starting enhanced page content extraction"),console.log("üîç CONTENT EXTRACTION DEBUG - Current URL:",window.location.href),console.log("üîç CONTENT EXTRACTION DEBUG - Page title:",document.title);const e=["nav","header","footer","aside",'[role="navigation"]','[role="banner"]','[role="contentinfo"]',".navigation",".nav",".menu",".header",".footer",".sidebar",".advertisement",".ad",".ads",".promo",".promotion",".breadcrumb",".breadcrumbs",".tabs",".tab","script","style","noscript"],t=['[class*="order-detail"]','[id*="order-detail"]','[class*="order-summary"]','[id*="order-summary"]','[class*="order-info"]','[id*="order-info"]','[class*="invoice"]','[id*="invoice"]','[class*="receipt"]','[id*="receipt"]','[class*="confirmation"]','[id*="confirmation"]',".order",".purchase",".transaction"],o=["main",'[role="main"]',".main-content","#main-content","h1, h2, h3",".title",".price",".total",".amount"];let n="",i=0,r=!1;console.log("üîç CONTENT EXTRACTION DEBUG - Checking priority selectors...");for(const o of t){const t=document.querySelectorAll(o);t.length>0&&(console.log(`üîç CONTENT EXTRACTION DEBUG - Found ${t.length} priority elements for: ${o}`),t.forEach((t,o)=>{const s=this.cleanElementText(t,e);s.length>20&&(n+=s+" ",i++,r=!0,o<2&&console.log(`üîç CONTENT EXTRACTION DEBUG - Priority content: ${s.slice(0,100)}...`))}))}if(!r){console.log("üîç CONTENT EXTRACTION DEBUG - No priority content found, trying general selectors...");for(const t of o){const o=document.querySelectorAll(t);if(o.length>0&&(console.log(`üîç CONTENT EXTRACTION DEBUG - Found ${o.length} general elements for: ${t}`),o.forEach((t,o)=>{const s=this.cleanElementText(t,e);s.length>10&&(n+=s+" ",i++,r=!0,o<2&&console.log(`üîç CONTENT EXTRACTION DEBUG - General content: ${s.slice(0,100)}...`))})),r&&n.length>200)break}}if(console.log("üîç CONTENT EXTRACTION DEBUG - Total elements processed:",i),console.log("üîç CONTENT EXTRACTION DEBUG - Raw extracted content length:",n.length),n=this.cleanAndNormalizeText(n),console.log("üîç CONTENT EXTRACTION DEBUG - Cleaned content length:",n.length),n.length<100){console.log("üîç CONTENT EXTRACTION DEBUG - Content still too short, using filtered body text");const t=document.body.cloneNode(!0);for(const o of e)t.querySelectorAll(o).forEach(e=>e.remove());n=t.textContent||t.innerText||"",n=this.cleanAndNormalizeText(n),console.log("üîç CONTENT EXTRACTION DEBUG - Filtered body text length:",n.length)}const s=n.slice(0,2e3);return console.log("üîç CONTENT EXTRACTION DEBUG - Final content length (after truncation):",s.length),console.log("üîç CONTENT EXTRACTION DEBUG - Final content preview (first 200 chars):",s.slice(0,200)),console.log("üîç CONTENT EXTRACTION DEBUG - Content quality check - has order keywords:",/\b(order|purchase|total|amount|price|date|customer|product|item|quantity|invoice|receipt)\b/i.test(s)),s}cleanElementText(e,t){const o=e.cloneNode(!0);for(const e of t)o.querySelectorAll(e).forEach(e=>e.remove());let n=o.textContent||"";return n=n.replace(/\s+/g," ").trim(),n}cleanAndNormalizeText(e){return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/[\t\n\r\f\v]+/g," ")).replace(/\s{2,}/g," ")).replace(/\(\s*\)/g,"")).replace(/\[\s*\]/g,"")).replace(/\{\s*\}/g,"")).replace(/[.,;:!?]{2,}/g,".")).replace(/\b[a-zA-Z]\b/g,"")).replace(/\.{2,}/g,".")).replace(/-{2,}/g,"-")).replace(/\s+([.,;:!?])/g,"$1")).replace(/([.,;:!?])\s*([.,;:!?])/g,"$1")).replace(/\s+/g," ").trim()}getCacheKey(e){let t=0;for(let o=0;o<Math.min(e.length,100);o++)t=(t<<5)-t+e.charCodeAt(o),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT-Inspired Order Classifier",model:"advanced-pattern-sentiment-classifier",type:"keyword-pattern-sentiment-analysis",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=n)}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,o),r.loaded=!0,r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(481)})();