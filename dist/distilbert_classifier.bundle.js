(()=>{"use strict";var e={481:(e,t,o)=>{e=o.hmd(e);class i{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{return console.log("üîÑ Loading DistilBERT model..."),this.classifier=await this.createSentimentClassifier(),this.isLoaded=!0,console.log("‚úÖ DistilBERT-inspired model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async createSentimentClassifier(){return e=>{const t=e.toLowerCase(),o=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity","price","confirmation","thank you","estimated delivery"].filter(e=>t.includes(e)).length,i=[/order\s*#?\s*[a-z0-9\-]+/i,/\$[\d,]+\.?\d*/,/total:?\s*\$?[\d,]+\.?\d*/i,/delivered?\s+on/i,/shipped?\s+on/i,/tracking\s+(number|#)/i].filter(t=>t.test(e)).length,n=["confirmed","success","complete","delivered","shipped","thank","congratulations","approved","processed"].filter(e=>t.includes(e)).length,s=.5*Math.min(o/8,1)+.3*Math.min(i/3,1)+.2*Math.min(n/4,1),r=s>.4;return[{label:r?"POSITIVE":"NEGATIVE",score:r?.6+.4*s:.4-.4*s}]}}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");console.log("üîç CLASSIFICATION DEBUG - Input text length:",e.length),console.log("üîç CLASSIFICATION DEBUG - First 200 chars:",e.slice(0,200));const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const o=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],i=e.toLowerCase(),n=o.filter(e=>i.includes(e)),s=n.length;console.log("üîç CLASSIFICATION DEBUG - Found keywords:",n),console.log("üîç CLASSIFICATION DEBUG - Keyword matches:",s);const r=await this.classifier(e);console.log("üîç CLASSIFICATION DEBUG - Sentiment result:",r);const c=Math.min(s/5,1),l=r[0].score;console.log("üîç CLASSIFICATION DEBUG - Keyword confidence:",c.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Sentiment confidence:",l.toFixed(3));const a=.7*c+.3*l,d=s>=2&&a>.6;console.log("üîç CLASSIFICATION DEBUG - Combined confidence:",a.toFixed(3)),console.log("üîç CLASSIFICATION DEBUG - Is order page?",d),console.log("üîç CLASSIFICATION DEBUG - Decision logic: keywordMatches >= 2 && combinedConfidence > 0.6"),console.log("üîç CLASSIFICATION DEBUG - Actual: keywordMatches =",s,", combinedConfidence =",a.toFixed(3));const h={isOrder:d,confidence:a,method:"distilbert-sentiment-adapted",topLabel:d?"order page":"non-order page",allPredictions:[{label:"order page",score:a},{label:"non-order page",score:1-a}],details:{model:this.modelName,keywordMatches:s,keywordConfidence:c,sentimentResult:r,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:h,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:d,confidence:a.toFixed(3),keywordMatches:s,sentiment:r[0].label}),h}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){const e=this.extractPageContent();return{...await this.classify(e),pageInfo:{url:window.location.href,title:document.title,contentLength:e.length}}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const o=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let i,n;return t.isOrder?(i=o.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||o[0],n=t.confidence):(i=o.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||o[o.length-1],n=1-t.confidence),{isOrder:t.isOrder,confidence:n,method:"distilbert-sentiment-custom",topLabel:i,allPredictions:o.map(e=>{const i=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:i===t.isOrder?n:(1-n)/(o.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){console.log("üîç CONTENT EXTRACTION DEBUG - Starting page content extraction"),console.log("üîç CONTENT EXTRACTION DEBUG - Current URL:",window.location.href),console.log("üîç CONTENT EXTRACTION DEBUG - Page title:",document.title);const e=["main",'[role="main"]',".order",".invoice",".receipt",".confirmation",".order-details",".purchase-summary","h1, h2, h3",".title",".price",".total"];let t="",o=0;for(const i of e){const e=document.querySelectorAll(i);console.log(`üîç CONTENT EXTRACTION DEBUG - Selector "${i}" found ${e.length} elements`),e.forEach((e,i)=>{if(e.textContent&&e.textContent.trim()){const n=e.textContent.trim();t+=n+" ",o++,i<3&&console.log(`üîç CONTENT EXTRACTION DEBUG - Element ${i} text (first 100 chars):`,n.slice(0,100))}})}console.log("üîç CONTENT EXTRACTION DEBUG - Total elements found:",o),console.log("üîç CONTENT EXTRACTION DEBUG - Extracted content length:",t.length),t.length<50&&(console.log("üîç CONTENT EXTRACTION DEBUG - Content too short, falling back to body text"),t=document.body.textContent||document.body.innerText||"",console.log("üîç CONTENT EXTRACTION DEBUG - Body text length:",t.length));const i=t.slice(0,2e3);return console.log("üîç CONTENT EXTRACTION DEBUG - Final content length (after truncation):",i.length),console.log("üîç CONTENT EXTRACTION DEBUG - Final content preview (first 300 chars):",i.slice(0,300)),i}getCacheKey(e){let t=0;for(let o=0;o<Math.min(e.length,100);o++)t=(t<<5)-t+e.charCodeAt(o),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT-Inspired Order Classifier",model:"advanced-pattern-sentiment-classifier",type:"keyword-pattern-sentiment-analysis",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=i),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=i)}},t={};function o(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i](s,s.exports,o),s.loaded=!0,s.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(481)})();