(()=>{"use strict";var e={481:(e,t,i)=>{e=i.hmd(e);class o{constructor(){this.isLoaded=!1,this.classifier=null,this.modelName="Xenova/distilbert-base-uncased-finetuned-sst-2-english",this.cache=new Map,this.cacheTimeout=3e5}async loadModel(){if(this.isLoaded&&this.classifier)return!0;try{if(console.log("üîÑ Loading DistilBERT model..."),void 0===window.pipeline&&await this.loadTransformersLibrary(),void 0===window.pipeline)throw new Error("Pipeline function not available. Make sure @xenova/transformers is loaded.");return this.classifier=await window.pipeline("sentiment-analysis",this.modelName),this.isLoaded=!0,console.log("‚úÖ DistilBERT model loaded successfully"),!0}catch(e){throw console.error("‚ùå Failed to load DistilBERT model:",e),new Error(`DistilBERT model loading failed: ${e.message}`)}}async loadTransformersLibrary(){if(void 0===window.pipeline)return console.log("üì¶ Loading @xenova/transformers library..."),new Promise((e,t)=>{const i=document.createElement("script");i.type="module",i.textContent="\n        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';\n        window.pipeline = pipeline;\n        window.transformersLoaded = true;\n      ",i.onload=()=>{const t=()=>{window.transformersLoaded?(console.log("‚úÖ Transformers library loaded successfully"),e()):setTimeout(t,100)};t()},i.onerror=()=>{t(new Error("Failed to load transformers library"))},document.head.appendChild(i)})}async classify(e){if(this.isLoaded||await this.loadModel(),!e||"string"!=typeof e)throw new Error("Invalid text input for DistilBERT classification");const t=this.getCacheKey(e);if(this.cache.has(t)){const e=this.cache.get(t);if(Date.now()-e.timestamp<this.cacheTimeout)return console.log("üìã Using cached DistilBERT classification"),e.result}try{const i=["order","purchase","buy","transaction","invoice","receipt","confirmed","shipped","delivered","payment","total","amount","order id","order number","tracking","quantity"],o=e.toLowerCase(),r=i.filter(e=>o.includes(e)).length,s=await this.classifier(e),n=Math.min(r/5,1),a=.7*n+.3*s[0].score,l=r>=2&&a>.6,c={isOrder:l,confidence:a,method:"distilbert-sentiment-adapted",topLabel:l?"order page":"non-order page",allPredictions:[{label:"order page",score:a},{label:"non-order page",score:1-a}],details:{model:this.modelName,keywordMatches:r,keywordConfidence:n,sentimentResult:s,timestamp:(new Date).toISOString()}};return this.cache.set(t,{result:c,timestamp:Date.now()}),console.log("ü§ñ DistilBERT classification:",{isOrder:l,confidence:a.toFixed(3),keywordMatches:r,sentiment:s[0].label}),c}catch(e){throw console.error("‚ùå DistilBERT classification failed:",e),new Error(`DistilBERT classification failed: ${e.message}`)}}async classifyPage(){try{const e=this.extractPageContent();if(!e||e.trim().length<50)throw new Error("Insufficient page content for DistilBERT classification");const t=await this.classify(e);return t.pageInfo={contentLength:e.length,url:window.location.href,title:document.title,timestamp:(new Date).toISOString(),modelUsed:"DistilBERT MNLI"},t}catch(e){throw console.error("‚ùå DistilBERT page classification error:",e),e}}async classifyWithCustomLabels(e,t=null){this.isLoaded||await this.loadModel();const i=t||["e-commerce order confirmation page","shopping cart or checkout page","order tracking or status page","product catalog or listing page","general website content","customer service or help page"];try{const t=await this.classify(e);let o,r;return t.isOrder?(o=i.find(e=>e.includes("order")||e.includes("cart")||e.includes("tracking"))||i[0],r=t.confidence):(o=i.find(e=>e.includes("catalog")||e.includes("general")||e.includes("help"))||i[i.length-1],r=1-t.confidence),{isOrder:t.isOrder,confidence:r,method:"distilbert-sentiment-custom",topLabel:o,allPredictions:i.map(e=>{const o=e.includes("order")||e.includes("cart")||e.includes("tracking");return{label:e,score:o===t.isOrder?r:(1-r)/(i.length-1)}}).sort((e,t)=>t.score-e.score)}}catch(e){throw new Error(`Custom DistilBERT classification failed: ${e.message}`)}}extractPageContent(){const e=["main",'[role="main"]',".order",".invoice",".receipt",".confirmation",".order-details",".order-summary","h1, h2, h3",".title",".heading",".product-title",".checkout",".cart"];let t="";for(const i of e){const e=document.querySelectorAll(i);for(const i of e)i.textContent&&(t+=i.textContent+" ")}return t.trim().length<100&&(t=document.body.textContent||""),t.substring(0,2e3)}getCacheKey(e){let t=0;for(let i=0;i<Math.min(e.length,100);i++)t=(t<<5)-t+e.charCodeAt(i),t&=t;return`distilbert_${Math.abs(t)}_${e.length}`}clearCache(){this.cache.clear(),console.log("üóëÔ∏è DistilBERT classification cache cleared")}getModelInfo(){return{name:"DistilBERT Order Classifier",model:this.modelName,type:"sentiment-analysis-adapted",loaded:this.isLoaded,cacheSize:this.cache.size}}}e.exports&&(e.exports=o),"undefined"!=typeof window&&(window.DistilBERTMNLIClassifier=o)}},t={};function i(o){var r=t[o];if(void 0!==r)return r.exports;var s=t[o]={id:o,loaded:!1,exports:{}};return e[o](s,s.exports,i),s.loaded=!0,s.exports}i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i(481)})();